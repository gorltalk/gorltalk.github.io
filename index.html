<!DOCTYPE html>
<html>
<head>
    <title>GorlTalk Boombox</title>
    <meta name="referrer" content="no-referrer">
    <style>
        body {
            background: #000;
            margin: 0;
            padding: 10px;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #boombox-container {
            position: relative;
            display: inline-block;
            width: 430px;
            max-width: 100%;
            margin: 0 auto;
        }
        #boombox {
            width: 100%;
            height: auto;
            display: block;
            cursor: pointer;
            user-select: none;
        }
        #status {
            color: #0ff;
            margin: 15px auto;
            font-size: 1em;
            min-height: 2em;
            max-width: 430px;
            word-wrap: break-word;
        }
        /* Visual debugging (remove when done) */
        .btn-debug {
            position: absolute;
            border: 2px solid lime;
            background: rgba(0,255,0,0.2);
            pointer-events: none;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="boombox-container">
        <img id="boombox" src="https://gorltalk.github.io/boombox.png" usemap="#buttons" alt="Boombox">
        
        <!-- Debug overlays (remove when working) -->
        <div class="btn-debug" style="left: 693px; top: 584px; width: 43px; height: 37px;"></div>
        <div class="btn-debug" style="left: 743px; top: 583px; width: 39px; height: 40px;"></div>
        <div class="btn-debug" style="left: 792px; top: 583px; width: 40px; height: 40px;"></div>
        
        <!-- Active button areas -->
        <map name="buttons">
            <area shape="rect" coords="693,584,736,621" data-action="prev" href="javascript:void(0)" alt="Previous" title="Previous Track">
            <area shape="rect" coords="743,583,782,623" data-action="play" href="javascript:void(0)" alt="Play/Pause" title="Play/Pause">
            <area shape="rect" coords="792,583,832,623" data-action="next" href="javascript:void(0)" alt="Next" title="Next Track">
        </map>
    </div>
    
    <div id="status">üîá Loading boombox...</div>
    
    <!-- Hidden YouTube player -->
    <div id="player"></div>

    <script>
        // Player configuration
        const config = {
            initialVolume: 80,
            playlist: [
                { id: 'dQw4w9WgXcQ', title: 'Rick Astley - Never Gonna Give You Up' },
                { id: '9bZkp7q19f0', title: 'PSY - GANGNAM STYLE' },
                { id: 'JGwWNGJdvx8', title: 'Ed Sheeran - Shape of You' },
                { id: 'kJQP7kiw5Fk', title: 'Luis Fonsi - Despacito' }
            ]
        };

        // Player state
        const state = {
            player: null,
            ready: false,
            currentTrack: 0
        };

        // Load YouTube API
        function loadYouTubeAPI() {
            return new Promise((resolve) => {
                if (window.YT) return resolve();
                
                window.onYouTubeIframeAPIReady = resolve;
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                tag.onerror = () => {
                    console.error("YouTube API failed to load");
                    document.getElementById('status').textContent = "‚ùå YouTube failed to load";
                    resolve();
                };
                document.head.appendChild(tag);
            });
        }

        // Initialize player
        async function initPlayer() {
            try {
                await loadYouTubeAPI();
                
                if (!window.YT) {
                    throw new Error("YouTube API not available");
                }
                
                state.player = new YT.Player('player', {
                    height: '0',
                    width: '0',
                    videoId: config.playlist[state.currentTrack].id,
                    playerVars: {
                        origin: window.location.origin,
                        autoplay: 0,
                        controls: 0,
                        modestbranding: 1,
                        rel: 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            } catch (error) {
                console.error("Player initialization failed:", error);
                document.getElementById('status').textContent = "‚ùå Player error - check console";
            }
        }

        function onPlayerReady(event) {
            state.ready = true;
            event.target.setVolume(config.initialVolume);
            updateStatus("‚úÖ Ready! Click PLAY");
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                playNext();
            }
        }

        // Player controls
        function playPrev() {
            state.currentTrack = (state.currentTrack - 1 + config.playlist.length) % config.playlist.length;
            state.player.loadVideoById(config.playlist[state.currentTrack].id);
            updateStatus();
        }

        function playNext() {
            state.currentTrack = (state.currentTrack + 1) % config.playlist.length;
            state.player.loadVideoById(config.playlist[state.currentTrack].id);
            updateStatus();
        }

        function togglePlay() {
            if (state.player.getPlayerState() === YT.PlayerState.PLAYING) {
                state.player.pauseVideo();
            } else {
                state.player.playVideo();
            }
            updateStatus();
        }

        // UI updates
        function updateStatus(customMessage) {
            const statusEl = document.getElementById('status');
            if (customMessage) {
                statusEl.innerHTML = customMessage;
                return;
            }
            
            const song = config.playlist[state.currentTrack];
            const isPlaying = state.player.getPlayerState() === YT.PlayerState.PLAYING;
            statusEl.innerHTML = isPlaying 
                ? `‚ñ∂Ô∏è Playing: <strong>${song.title}</strong>` 
                : `‚è∏ Paused: <strong>${song.title}</strong>`;
        }

        // Setup button controls
        function setupControls() {
            const controls = {
                prev: () => { if (state.ready) playPrev(); },
                play: () => { if (state.ready) togglePlay(); },
                next: () => { if (state.ready) playNext(); }
            };
            
            document.querySelectorAll('area[data-action]').forEach(area => {
                const action = area.getAttribute('data-action');
                area.addEventListener('click', (e) => {
                    e.preventDefault();
                    controls[action]();
                });
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initPlayer();
            setupControls();
        });
    </script>
</body>
</html>
